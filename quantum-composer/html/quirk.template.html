<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Quantum Composer</title>
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <div class="app" id="app">
    <canvas id="dragCanvas" style="z-index: 888;">
    </canvas>
    <div class="header">
      <div class="circuit-name">Project name</div>
      <div class="tab">
        <div class="tab-child" data-state="active">Circuit</div>
        <div class="tab-child">Simulate</div>
      </div>
      <div class="quick-menu">
        <button class="quick-menu-btn">Save</button>
        <button class="quick-menu-btn">Import</button>
        <button class="quick-menu-btn">Export</button>
        <button class="quick-menu-btn">Share</button>
        <button class="quick-menu-btn">Help</button>
      </div>
    </div>
    <div class="content">
      <div class="gate-area">
        <div class="gate-area-header">
          <input type="search" class="gate-area-header-search" id="gate-area-header-search" oninput="handleSearch()">
          <button class="gate-area-header-btn" id="gate-area-header-grid-btn" onclick="handleGroupOnClicked()">List</button>
          <button class="gate-area-header-btn" id="gate-area-header-list-btn" onclick="handleGroupOffClicked()">Grid</button>
          <button class="gate-area-header-btn" id="gate-area-header-close-btn">X</button>
        </div>
        <div class="gate-area-body">
          <label class="gate-area-body-section-label">Commons gates</label>
          <div class="gate-area-body-common-gates">
            <div class="gateList">
              <div id="common-gates">
              </div> 
            </div>
            <div class="gateGrid" style="display: none;">
              <div id="common-gates-grid">
              </div> 
            </div>
                       
          </div>
          <label class="gate-area-body-section-label">Advanced gates</label>
          <div class="gate-area-body-advanced-gates">
            <div class="gateList">
              <div id="advanced-gates">
              </div>   
            </div>
            <div class="gateGrid" style="display: none;">
              <div id="advanced-gates-grid">
              </div>   
            </div>
          </div>
        </div>
      </div>
      <div class="circuit-area">
        <div class="circuit-area-header">
          <button class="circuit-area-header-btn" id="undo-button">Undo</button>
          <button class="circuit-area-header-btn" id="redo-button">Redo</button>
          <button class="circuit-area-header-btn" id="clear-button">Clear</button>
        </div>        
        <div class="circuit-area-body" id="circuit-area-body">
          <canvas id="drawCanvas">            
          </canvas>
        </div>
        <div class="circuit-area-chart" id="circuit-chart">
          <button id="circuit-area-chart-close-btn">X</button>
          <button id="stateBarChartFilterZero">Hide zero states</button>
          <div id="stateBarChart"></div>
          <div id="stateVectorChart"></div>
        </div>
      </div>
      <div class="code-area">
        <button id="code-area-close-btn">X</button>
      </div>
    </div>
    <div id="gate-menu-popup" style="z-index: 888;">
      <button class="gate-menu-popup-btn" id="gate-menu-popup-info-btn">Info</button>
      <button class="gate-menu-popup-btn" id="gate-menu-popup-cut-btn">Cut</button>
      <button class="gate-menu-popup-btn" id="gate-menu-popup-copy-btn">Copy</button>
      <button class="gate-menu-popup-btn" id="gate-menu-popup-paste-btn">Paste</button>
      <button class="gate-menu-popup-btn" id="gate-menu-popup-delete-btn">Delete</button>
    </div>
  </div>

  <!-- Primary content -->

  <!-- Circuit drawing area -->

  <!-- INCLUDE EXPORT PART -->

  <!-- INCLUDE FORGE PART -->

  <!-- INCLUDE MENU PART -->

  <!-- INCLUDE ERROR PART -->

  <!-- Javascript detection -->
  <div id="noscript-div" class="noscript-warning">
    You appear to have JavaScript blocked. And Quirk is made out of JavaScript... :(
  </div>
  <script src='./dist/d3.min.js'></script>
  <script>
    document.D3_FUNCTION = {
      bar: (barData) => {
        let margin = {top: 30, right: 30, bottom: 70, left: 60},
                width = (barData.length * 15) - margin.left - margin.right,
                height = 190 - margin.top - margin.bottom;
        if  (width <= 600){
          width = 600;
        }
        let svg = d3.select("#stateBarChart");
        svg.selectAll("*").remove();
        svg = d3.select("#stateBarChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        let x = d3.scaleBand()
                .range([0,width])
                .domain(barData.map(function (d){return d.State;}))
                .padding(0.2);
        svg.append("g")
                .attr("transform","translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor","end");
        svg.append("text")
                .attr("class","x label")
                .attr("text-anchor","end")
                .attr("dy", 2.5 + (Math.sqrt(barData.length)/10 - .45) +"rem")
                .attr("x", width)
                .attr("y", height)
                .text("Computational basis states")
        let y = d3.scaleLinear()
                // .domain([0,100])
                .range([height, 0])
                .domain([0, d3.max(barData, function (d){ return Math.ceil(d.Probability)})])
        svg.append("g")
                .call(d3.axisLeft(y));
        svg.append("text")
                .attr("class","y label")
                .attr("text-anchor","end")
                .attr("y", 6)
                .attr("dy","-2.5rem")
                .attr("transform","rotate(-90)")
                .text("Probability(%)")
        const tooltip = d3.select("#stateBarChart").append("div")
                .attr("class","barTooltip")
                .style("opacity", 0)
        let g = svg.selectAll("mybar")
                .data(barData)
                .enter()
        // svg.selectAll("mybar")
        //         .data(barData)
        //         .enter()
        g.append("rect")
                .attr("class","bar1")
                .attr("x", function (d) {return x(d.State);})
                .attr("y", function (d) {return y(d.Probability);})
                .attr("width", x.bandwidth())
                .attr("height", function (d) {return height - y(d.Probability)})
                .attr("fill", "#5BB0F8")
                .on("mouseover",(d)=>{
                  tooltip.transition().duration(200).style("opacity",.9);
                  tooltip.html(`State: <span>${d.State}</span><br>Probability: <span>${d.Probability}% </span>`)
                          .style('left', `${d3.event.layerX}px`)
                          .style('top', `${d3.event.layerY}px`);
                })
                .on("mouseout",()=>tooltip.transition().duration(500).style("opacity",0))
        g.append("rect")
                .attr("class","bar2")
                .attr("x", function (d) {return x(d.State)})
                .attr("y", function (d) {return d.Probability > 50 ? 0 : d.Probability})
                .attr("width", x.bandwidth())
                .attr("height",  height)
                .style("opacity", 0)
                .on("mouseover",(d)=>{
                  tooltip.transition().duration(200).style("opacity",.9);
                  tooltip.html(`State: <span>${d.State}</span><br>Probability: <span>${d.Probability}% </span>`)
                          .style('left', `${d3.event.layerX}px`)
                          .style('top', `${d3.event.layerY}px`);
                })
                .on("mouseout",()=>tooltip.transition().duration(500).style("opacity",0))
      }
    }
  </script>
  <script>
    document.getElementById('noscript-div').style.display = 'none';
    
    function handleGroupOnClicked() {
      const gateList = document.querySelectorAll('.gateList')
      const gateGrid = document.querySelectorAll('.gateGrid')
      gateList.forEach(item => {
        item.style.display = 'block'
      })      
      gateGrid.forEach(item => {
        item.style.display = 'none'
      })
    }
  
    function handleGroupOffClicked() {
      const gateList = document.querySelectorAll('.gateList')
      const gateGrid = document.querySelectorAll('.gateGrid')
      gateList.forEach(item => {
        item.style.display = 'none'
      })      
      gateGrid.forEach(item => {
        item.style.display = 'block'
      })
    }
    
    function grabGate(gate) {
      document.GRAB_GATE = gate;
    }

    function handleSearch() {
      let search = document.getElementById("gate-area-header-search").value.toLowerCase();
      console.log("search: ", search);

      const listGates = document.querySelectorAll('.list-view')
      const gridGates = document.querySelectorAll('.grid-view')
      if(search != null && search != '' && search != undefined) {
        listGates.forEach(item => {
          const matchList = item.querySelector("span") //element contains gate name
          if(!matchList.innerText.trim().toLowerCase().includes(search)) {
            item.style.display = "none"
          } else {
            item.style.display = "block"
          }
        })

        gridGates.forEach(item => {
          const gridMatchList = item.querySelector("div span")
          if(!gridMatchList.innerText.trim().toLowerCase().includes(search)) {
            item.style.display = "none"
          } else {
            item.style.display = "block"
          }
        })        
      }
      else {
        listGates.forEach(item => {
          item.style.display = "block"
        })
        gridGates.forEach(item => {
          item.style.display = "block"
        }) 
      }

    }

    function handleClear() {
      document.getElementById("gate-area-header-search").innerHTML = "";
    }
  </script>

  <script>
    document.getElementById('noscript-div').style.display = 'block';
    //noinspection InnerHTMLJS
    document.QUIRK_QUINE_ALL_HTML_ORIGINAL = '<!' + 'DOCTYPE html>\n<' + 'html>\n    ' +
      document.documentElement.innerHTML + '\n<' + '/html>';
    document.getElementById('noscript-div').style.display = 'none';
    //DEFAULT_CIRCUIT_START
    document.DEFAULT_CIRCUIT = undefined;
        //DEFAULT_CIRCUIT_END

        // UN-MINIFIED SOURCE IS AVAILABLE FROM github.com/Strilanc/Quirk

    <!-- INCLUDE SOURCE PART -->

  </script>
</body>

</html>